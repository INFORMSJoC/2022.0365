function [mae0,mae,mse0,mse,cost0,cost,sl0,sl]=DBCD51fpgg1LS(x,xx,y,yy,ytrain,ytest,d,p,h,c)
n1=length(x(1,1,1,:,1));
n2=length(x(1,1,:,1,1));
n3=length(x(1,:,1,1,1));
n4=length(x(:,1,1,1,1));
nn2=length(xx(1,1,:,1,1));
h=h(1:n4,:);
p=p(1:n4,:);
d=d(:);
c=c(1:n4,:,:);
s10=(sign(ytrain)+1)/2;
ytrain1=sign(s10);
ytrain2=ytrain1.*ytrain;
s20=(sign(ytest)+1)/2;
ytest1=sign(s20);
ytest2=ytest1.*ytest;
tic
mae0(:,:,:,1)=abs(ytrain2(:,:,:,1)-y(:,:,:,1));
sl0(:,:,:,1)=max(min(ytrain2(:,:,:,1),y(:,:,:,1)),0)./(y(:,:,:,1)+(sign(y(:,:,:,1))-1)*(-exp(100)));
mse0(:,:,:,1)=mae0(:,:,:,1).^2;
mae(:,:,:,1)=abs(ytest2(:,:,:,1)-yy(:,:,:,1));
sl(:,:,:,1)=max(min(ytest2(:,:,:,1),yy(:,:,:,1)),0)./(yy(:,:,:,1)+(sign(yy(:,:,:,1))-1)*(-exp(100)));
mse(:,:,:,1)=mae(:,:,:,1).^2;
s=((sign(ytrain2(:,:,:,1)-y(:,:,:,1))+1)./2);
cost01(:,:,:,1)=repmat(h(:,1),1,n3,n2).*(ytrain2(:,:,:,1)-y(:,:,:,1))+repmat(c(:,:,1),1,1,n2).*ytrain2(:,:,:,1);
cost01(:,:,:,1)=cost01(:,:,:,1).*s;
s=((sign(-ytrain2(:,:,:,1)+y(:,:,:,1))+1)./2);
cost02(:,:,:,1)=d(1)*repmat(p(:,1),1,n3,n2).*(-ytrain2(:,:,:,1)+y(:,:,:,1))+repmat(c(:,:,1),1,1,n2).*ytrain2(:,:,:,1);
cost02(:,:,:,1)=cost02(:,:,:,1).*s;
cost0(:,:,:,1)=cost01(:,:,:,1)+cost02(:,:,:,1);
s=((sign(ytest2(:,:,:,1)-yy(:,:,:,1))+1)./2);
cost1(:,:,nn2,1)=repmat(h(:,1),1,n3,nn2).*(ytest2(:,:,:,1)-yy(:,:,:,1))+repmat(c(:,:,1),1,1,nn2).*ytest2(:,:,:,1);
cost1(:,:,nn2,1)=cost1(:,:,nn2,1).*s;
s=((sign(-ytest2(:,:,:,1)+yy(:,:,:,1))+1)./2);
cost2(:,:,nn2,1)=d(1)*repmat(p(:,1),1,n3,nn2).*(-ytest2(:,:,:,1)+yy(:,:,:,1))+repmat(c(:,:,1),1,1,nn2).*ytest2(:,:,:,1);
cost2(:,:,nn2,1)=cost2(:,:,nn2,1).*s;
cost(:,:,:,1)=cost1(:,:,:,1)+cost2(:,:,:,1);
for tt=2:n1
    s1=0;
    s0=0;
     for t=1:tt-1
         y1=y(:,:,:,t)-ytrain2(:,:,:,t);
         s0=s0+((sign(-y1)+1)./2).*y1;
         y2=yy(:,:,:,t)-ytest2(:,:,:,t);
         s1=s1+((sign(-y2)+1)./2).*y2;
     end
     s00=(sign(s0)+1)/2;
     sss0=sign(s00);
     ss0=sss0.*s0;
     s11=(sign(s1)+1)/2;
     sss1=sign(s11);
     ss=sss1.*s1;
     mae0(:,:,:,tt)=abs(ytrain2(:,:,:,tt)-ss0-y(:,:,:,tt));
     sl0(:,:,:,tt)=max(min(ytrain2(:,:,:,tt),y(:,:,:,tt)),0)./(y(:,:,:,tt)+(sign(y(:,:,:,tt))-1)*(-exp(100)));
     mse0(:,:,:,tt)=mae0(:,:,:,tt).^2;
     mae(:,:,:,tt)=abs(ytest2(:,:,:,tt)-ss-yy(:,:,:,tt));
     sl(:,:,:,tt)=max(min(ytest2(:,:,:,tt),yy(:,:,:,tt)),0)./(yy(:,:,:,tt)+(sign(yy(:,:,:,tt))-1)*(-exp(100)));
     mse(:,:,:,tt)=mae(:,:,:,tt).^2;
     s=((sign(ytrain2(:,:,:,1)-ss0-y(:,:,:,1))+1)./2);
     cost01(:,:,:,tt)=repmat(h(:,tt),1,n3,n2).*(ytrain2(:,:,:,tt)-ss0-y(:,:,:,tt))+repmat(c(:,:,tt),1,1,n2).*ytrain2(:,:,:,tt);
     cost01(:,:,:,tt)=cost01(:,:,:,tt).*s;
     s=((sign(-ytrain2(:,:,:,tt)+ss0+y(:,:,:,tt))+1)./2);
     cost02(:,:,:,tt)=d(tt)*repmat(p(:,1),1,n3,n2).*(-ytrain2(:,:,:,tt)+ss0+y(:,:,:,tt))+repmat(c(:,:,tt),1,1,n2).*ytrain2(:,:,:,tt);
     cost02(:,:,:,tt)=cost02(:,:,:,tt).*s;
     cost0(:,:,:,tt)=cost01(:,:,:,tt)+cost02(:,:,:,tt);
     s=((sign(ytest2(:,:,:,tt)-ss-yy(:,:,:,tt))+1)./2);
     cost1(:,:,nn2,tt)=repmat(h(:,tt),1,n3,nn2).*(ytest2(:,:,:,tt)-ss-yy(:,:,:,tt))+repmat(c(:,:,tt),1,1,nn2).*ytest2(:,:,:,tt);
     cost1(:,:,nn2,tt)=cost1(:,:,nn2,tt).*s;
     s=((sign(-ytest2(:,:,:,tt)+ss+yy(:,:,:,tt))+1)./2);
     cost2(:,:,nn2,tt)=d(1)*repmat(p(:,tt),1,n3,nn2).*(-ytest2(:,:,:,tt)+ss+yy(:,:,:,tt))+repmat(c(:,:,tt),1,1,nn2).*ytest2(:,:,:,tt);
     cost2(:,:,nn2,tt)=cost2(:,:,nn2,tt).*s;
     cost(:,:,:,tt)=cost1(:,:,:,tt)+cost2(:,:,:,tt);
end
mae=permute(mae,[1 2 4 3]);
mse=permute(mse,[1 2 4 3]);
cost=permute(cost,[1 2 4 3]);
toc